import{c as Y,q as m,b as W,d as x,e as C,f as U,v as d,m as g}from"./webgpuHelper-CJQbp9Wz.js";/* empty css              */const a=document.getElementById("canvas");a.width=window.innerWidth;a.height=window.innerHeight;let r,G,h,B,A,l,M,b,y,E=a.width/a.height;const O=Y(1,1,1);let w,p=m.identity(),v=m.identity();(async()=>(await X(),D(),H(O),I(),j(),k(a),L(),requestAnimationFrame(T)))();async function X(){const e=await W(a);r=e.device,G=e.context,h=e.format,b=x(a,r),y=C(a,r,h)}function D(){B=r.createRenderPipeline({layout:"auto",vertex:{module:r.createShaderModule({code:U}),entryPoint:"vs_main",buffers:[{arrayStride:32,attributes:[{shaderLocation:0,format:"float32x4",offset:0},{shaderLocation:1,format:"float32x4",offset:16}]}]},fragment:{module:r.createShaderModule({code:U}),entryPoint:"fs_main",targets:[{format:h}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"},multisample:{count:4}})}function H(e){A=N(r,e)}function I(){l=r.createBuffer({size:208,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}function j(){M=r.createBindGroup({layout:B.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:l}}]})}function T(){L();const e=r.createCommandEncoder(),t=e.beginRenderPass({colorAttachments:[{view:y.createView(),resolveTarget:G.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:{r:.3,g:.3,b:.3,a:1}}],depthStencilAttachment:{view:b.createView(),depthLoadOp:"clear",depthStoreOp:"store",depthClearValue:1}});t.setPipeline(B),J(t,A,M,O.length/8),t.end(),r.queue.submit([e.finish()]),requestAnimationFrame(T)}function V(e,t){var i=2,o=Math.sqrt(e*e+t*t),n=i*Math.sqrt(2),f;return o<i?f=Math.sqrt(i*i-o*o):o<n?f=0:f=n*n/o,f}function k(e){var t=!1,i=-1,o=-1;e.onmousedown=function(n){const f=n.target;var s=n.clientX,c=n.clientY,u=f.getBoundingClientRect();u.left<=s&&s<u.right&&u.top<=c&&c<u.bottom&&(i=s,o=c,t=!0)},e.onmouseup=function(){p=m.identity(),t=!1},e.onmousemove=function(n){const f=n.target;var s=n.clientX,c=n.clientY;if(t){var u=f.getBoundingClientRect(),q=((s-u.left)/u.width-.5)*2,P=(.5-(c-u.top)/u.height)*2,S=((i-u.left)/u.width-.5)*2,z=(.5-(o-u.top)/u.height)*2,R=d.fromValues(q,P,V(q,P)),F=d.fromValues(S,z,V(S,z));p=m.rotationTo(d.normalize(R),d.normalize(F)),v=m.mul(v,p)}i=s,o=c}}function N(e,t){const i=e.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});return e.queue.writeBuffer(i,0,t),i}function L(){const{perspective:e,view:t}=Q(),i=g.identity();r.queue.writeBuffer(l,0,i),r.queue.writeBuffer(l,64,t),r.queue.writeBuffer(l,128,e),r.queue.writeBuffer(l,192,new Float32Array(w))}function Q(){const e=90*Math.PI/180,o=g.perspective(e,E,.1,1e3);let n,f=new Float32Array([1,1,2]);w=d.transformQuat(f,v),n=[0,0,0];const s=[0,1,0],c=g.lookAt(w,n,s);return{perspective:o,view:c}}function J(e,t,i,o){e.setBindGroup(0,i),e.setVertexBuffer(0,t),e.draw(o,1,0,0)}window.addEventListener("resize",()=>{a.width=window.innerWidth,a.height=window.innerHeight,E=a.width/a.height,b=x(a,r),y=C(a,r,h)});
